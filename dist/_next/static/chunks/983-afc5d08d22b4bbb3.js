(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[983],{5252:function(t){t.exports=function(t){return atob(t)}},8139:function(t,e,i){"use strict";i.d(e,{pq:function(){return y},J7:function(){return a}});class r extends Error{}var s=i(3425);class a{constructor(t,e=!1,i=!0){this.device=t,this.tracing=e,this.slipReaderEnabled=!1,this.baudrate=0,this.traceLog="",this.lastTraceTime=Date.now(),this.buffer=new Uint8Array(0),this.SLIP_END=192,this.SLIP_ESC=219,this.SLIP_ESC_END=220,this.SLIP_ESC_ESC=221,this._DTR_state=!1,this.slipReaderEnabled=i}getInfo(){let t=this.device.getInfo();return t.usbVendorId&&t.usbProductId?`WebSerial VendorID 0x${t.usbVendorId.toString(16)} ProductID 0x${t.usbProductId.toString(16)}`:""}getPid(){return this.device.getInfo().usbProductId}trace(t){let e=Date.now()-this.lastTraceTime,i=`TRACE ${e.toFixed(3)}`,r=`${i} ${t}`;console.log(r),this.traceLog+=r+"\n"}async returnTrace(){try{await navigator.clipboard.writeText(this.traceLog),console.log("Text copied to clipboard!")}catch(t){console.error("Failed to copy text:",t)}}hexify(t){return Array.from(t).map(t=>t.toString(16).padStart(2,"0")).join("").padEnd(16," ")}hexConvert(t,e=!0){if(!e||!(t.length>16))return this.hexify(t);{let e="",i=t;for(;i.length>0;){let t=i.slice(0,16),r=String.fromCharCode(...t).split("").map(t=>" "===t||t>=" "&&t<="~"&&"  "!==t?t:".").join("");i=i.slice(16),e+=`
    ${this.hexify(t.slice(0,8))} ${this.hexify(t.slice(8))} | ${r}`}return e}}slipWriter(t){let e=[];e.push(192);for(let i=0;i<t.length;i++)219===t[i]?e.push(219,221):192===t[i]?e.push(219,220):e.push(t[i]);return e.push(192),new Uint8Array(e)}async write(t){let e=this.slipWriter(t);if(this.device.writable){let t=this.device.writable.getWriter();this.tracing&&(console.log("Write bytes"),this.trace(`Write ${e.length} bytes: ${this.hexConvert(e)}`)),await t.write(e),t.releaseLock()}}appendArray(t,e){let i=new Uint8Array(t.length+e.length);return i.set(t),i.set(e,t.length),i}async *readLoop(t){if(this.reader)try{for(;;){let e=new Promise((e,i)=>setTimeout(()=>i(Error("Read timeout exceeded")),t)),i=await Promise.race([this.reader.read(),e]);if(null===i)break;let{value:r,done:s}=i;if(s||!r)break;yield r}}catch(t){console.error("Error reading from serial port:",t)}finally{this.buffer=new Uint8Array(0)}}async newRead(t,e){if(this.buffer.length>=t){let e=this.buffer.slice(0,t);return this.buffer=this.buffer.slice(t),e}for(;this.buffer.length<t;){let t=this.readLoop(e),{value:i,done:r}=await t.next();if(r||!i)break;this.buffer=this.appendArray(this.buffer,i)}let i=this.buffer.slice(0,t);return this.buffer=this.buffer.slice(t),i}async flushInput(){var t;this.reader&&!await this.reader.closed&&(await this.reader.cancel(),this.reader.releaseLock(),this.reader=null===(t=this.device.readable)||void 0===t?void 0:t.getReader())}async flushOutput(){var t,e;this.buffer=new Uint8Array(0),await (null===(t=this.device.writable)||void 0===t?void 0:t.getWriter().close()),null===(e=this.device.writable)||void 0===e||e.getWriter().releaseLock()}inWaiting(){return this.buffer.length}detectPanicHandler(t){let e=new TextDecoder("utf-8").decode(t),i=e.match(/G?uru Meditation Error: (?:Core \d panic'ed \(([a-zA-Z ]*)\))?/)||e.match(/F?atal exception \(\d+\): (?:([a-zA-Z ]*)?.*epc)?/);if(i){let t=i[1]||i[2];throw Error(`Guru Meditation Error detected${t?` (${t})`:""}`)}}async *read(t){var e;this.reader||(this.reader=null===(e=this.device.readable)||void 0===e?void 0:e.getReader());let i=null,r=!1,s=!1;for(;;){let e=this.inWaiting(),a=await this.newRead(e>0?e:1,t);if(!a||0===a.length){let t=null===i?s?"Serial data stream stopped: Possible serial noise or corruption.":"No serial data received.":"Packet content transfer stopped";throw this.trace(t),Error(t)}this.trace(`Read ${a.length} bytes: ${this.hexConvert(a)}`);let n=0;for(;n<a.length;){let e=a[n++];if(null===i){if(e===this.SLIP_END)i=new Uint8Array(0);else{this.trace(`Read invalid data: ${this.hexConvert(a)}`);let i=await this.newRead(this.inWaiting(),t);throw this.trace(`Remaining data in serial buffer: ${this.hexConvert(i)}`),this.detectPanicHandler(new Uint8Array([...a,...i||[]])),Error(`Invalid head of packet (0x${e.toString(16)}): Possible serial noise or corruption.`)}}else if(r){if(r=!1,e===this.SLIP_ESC_END)i=this.appendArray(i,new Uint8Array([this.SLIP_END]));else if(e===this.SLIP_ESC_ESC)i=this.appendArray(i,new Uint8Array([this.SLIP_ESC]));else{this.trace(`Read invalid data: ${this.hexConvert(a)}`);let i=await this.newRead(this.inWaiting(),t);throw this.trace(`Remaining data in serial buffer: ${this.hexConvert(i)}`),this.detectPanicHandler(new Uint8Array([...a,...i||[]])),Error(`Invalid SLIP escape (0xdb, 0x${e.toString(16)})`)}}else e===this.SLIP_ESC?r=!0:e===this.SLIP_END?(this.trace(`Received full packet: ${this.hexConvert(i)}`),this.buffer=this.appendArray(this.buffer,a.slice(n)),yield i,i=null,s=!0):i=this.appendArray(i,new Uint8Array([e]))}}}async *rawRead(){if(this.reader)try{for(;;){let{value:t,done:e}=await this.reader.read();if(e||!t)break;this.tracing&&(console.log("Raw Read bytes"),this.trace(`Read ${t.length} bytes: ${this.hexConvert(t)}`)),yield t}}catch(t){console.error("Error reading from serial port:",t)}finally{this.buffer=new Uint8Array(0)}}async setRTS(t){await this.device.setSignals({requestToSend:t}),await this.setDTR(this._DTR_state)}async setDTR(t){this._DTR_state=t,await this.device.setSignals({dataTerminalReady:t})}async connect(t=115200,e={}){var i;await this.device.open({baudRate:t,dataBits:null==e?void 0:e.dataBits,stopBits:null==e?void 0:e.stopBits,bufferSize:null==e?void 0:e.bufferSize,parity:null==e?void 0:e.parity,flowControl:null==e?void 0:e.flowControl}),this.baudrate=t,this.reader=null===(i=this.device.readable)||void 0===i?void 0:i.getReader()}async sleep(t){return new Promise(e=>setTimeout(e,t))}async waitForUnlock(t){for(;this.device.readable&&this.device.readable.locked||this.device.writable&&this.device.writable.locked;)await this.sleep(t)}async disconnect(){var t,e;(null===(t=this.device.readable)||void 0===t?void 0:t.locked)&&await (null===(e=this.reader)||void 0===e?void 0:e.cancel()),await this.waitForUnlock(400),await this.device.close(),this.reader=void 0}}function n(t){return new Promise(e=>setTimeout(e,t))}class h{constructor(t,e){this.resetDelay=e,this.transport=t}async reset(){await this.transport.setDTR(!1),await this.transport.setRTS(!0),await n(100),await this.transport.setDTR(!0),await this.transport.setRTS(!1),await n(this.resetDelay),await this.transport.setDTR(!1)}}class o{constructor(t){this.transport=t}async reset(){await this.transport.setRTS(!1),await this.transport.setDTR(!1),await n(100),await this.transport.setDTR(!0),await this.transport.setRTS(!1),await n(100),await this.transport.setRTS(!0),await this.transport.setDTR(!1),await this.transport.setRTS(!0),await n(100),await this.transport.setRTS(!1),await this.transport.setDTR(!1)}}class l{constructor(t,e=!1){this.transport=t,this.usingUsbOtg=e,this.transport=t}async reset(){this.usingUsbOtg?(await n(200),await this.transport.setRTS(!1),await n(200)):(await n(100),await this.transport.setRTS(!1))}}class c{constructor(t,e){this.transport=t,this.sequenceString=e,this.transport=t}async reset(){let t={D:async t=>await this.transport.setDTR(t),R:async t=>await this.transport.setRTS(t),W:async t=>await n(t)};try{if(!function(t){let e=["D","R","W"];for(let i of t.split("|")){let t=i[0],r=i.slice(1);if(!e.includes(t))return!1;if("D"===t||"R"===t){if("0"!==r&&"1"!==r)return!1}else if("W"===t){let t=parseInt(r);if(isNaN(t)||t<=0)return!1}}return!0}(this.sequenceString))return;for(let e of this.sequenceString.split("|")){let i=e[0],r=e.slice(1);"W"===i?await t.W(Number(r)):("D"===i||"R"===i)&&await t[i]("1"===r)}}catch(t){throw Error("Invalid custom reset sequence")}}}var d=i(5252),u=i.n(d);async function _(t){let e;switch(t){case"ESP32":e=await i.e(421).then(i.t.bind(i,1421,19));break;case"ESP32-C2":e=await i.e(592).then(i.t.bind(i,3732,19));break;case"ESP32-C3":e=await i.e(961).then(i.t.bind(i,4961,19));break;case"ESP32-C5":e=await i.e(396).then(i.t.bind(i,6396,19));break;case"ESP32-C6":e=await i.e(224).then(i.t.bind(i,8224,19));break;case"ESP32-C61":e=await i.e(481).then(i.t.bind(i,9481,19));break;case"ESP32-H2":e=await i.e(811).then(i.t.bind(i,3811,19));break;case"ESP32-P4":e=await i.e(802).then(i.t.bind(i,3802,19));break;case"ESP32-S2":e=await i.e(788).then(i.t.bind(i,9788,19));break;case"ESP32-S3":e=await i.e(887).then(i.t.bind(i,9887,19));break;case"ESP8266":e=await i.e(963).then(i.t.bind(i,5963,19))}if(e)return{bss_start:e.bss_start,data:e.data,data_start:e.data_start,entry:e.entry,text:e.text,text_start:e.text_start,decodedData:f(e.data),decodedText:f(e.text)}}function f(t){return new Uint8Array(u()(t).split("").map(function(t){return t.charCodeAt(0)}))}async function p(t){switch(t){case 15736195:{let{ESP32ROM:t}=await i.e(146).then(i.bind(i,8146));return new t}case 203546735:case 1867591791:case 2084675695:{let{ESP32C2ROM:t}=await i.e(668).then(i.bind(i,3668));return new t}case 1763790959:case 456216687:case 1216438383:case 1130455151:{let{ESP32C3ROM:t}=await i.e(456).then(i.bind(i,7456));return new t}case 752910447:{let{ESP32C6ROM:t}=await i.e(771).then(i.bind(i,3771));return new t}case 606167151:case 871374959:case 1333878895:{let{ESP32C61ROM:t}=await i.e(466).then(i.bind(i,466));return new t}case 285294703:case 1675706479:case 1607549039:{let{ESP32C5ROM:t}=await i.e(958).then(i.bind(i,8958));return new t}case 3619110528:case 2548236392:{let{ESP32H2ROM:t}=await i.e(231).then(i.bind(i,1231));return new t}case 9:{let{ESP32S3ROM:t}=await i.e(326).then(i.bind(i,5326));return new t}case 1990:{let{ESP32S2ROM:t}=await i.e(642).then(i.bind(i,5642));return new t}case 4293968129:{let{ESP8266ROM:t}=await i.e(502).then(i.bind(i,1502));return new t}case 0:case 182303440:case 117676761:{let{ESP32P4ROM:t}=await i.e(467).then(i.bind(i,2467));return new t}default:return null}}class y{constructor(t){var e,i,r,s,n,d,u,_;this.ESP_RAM_BLOCK=6144,this.ESP_FLASH_BEGIN=2,this.ESP_FLASH_DATA=3,this.ESP_FLASH_END=4,this.ESP_MEM_BEGIN=5,this.ESP_MEM_END=6,this.ESP_MEM_DATA=7,this.ESP_WRITE_REG=9,this.ESP_READ_REG=10,this.ESP_SPI_ATTACH=13,this.ESP_CHANGE_BAUDRATE=15,this.ESP_FLASH_DEFL_BEGIN=16,this.ESP_FLASH_DEFL_DATA=17,this.ESP_FLASH_DEFL_END=18,this.ESP_SPI_FLASH_MD5=19,this.ESP_ERASE_FLASH=208,this.ESP_ERASE_REGION=209,this.ESP_READ_FLASH=210,this.ESP_RUN_USER_CODE=211,this.ESP_IMAGE_MAGIC=233,this.ESP_CHECKSUM_MAGIC=239,this.ROM_INVALID_RECV_MSG=5,this.DEFAULT_TIMEOUT=3e3,this.ERASE_REGION_TIMEOUT_PER_MB=3e4,this.ERASE_WRITE_TIMEOUT_PER_MB=4e4,this.MD5_TIMEOUT_PER_MB=8e3,this.CHIP_ERASE_TIMEOUT=12e4,this.FLASH_READ_TIMEOUT=1e5,this.MAX_TIMEOUT=2*this.CHIP_ERASE_TIMEOUT,this.CHIP_DETECT_MAGIC_REG_ADDR=1073745920,this.DETECTED_FLASH_SIZES={18:"256KB",19:"512KB",20:"1MB",21:"2MB",22:"4MB",23:"8MB",24:"16MB"},this.DETECTED_FLASH_SIZES_NUM={18:256,19:512,20:1024,21:2048,22:4096,23:8192,24:16384},this.USB_JTAG_SERIAL_PID=4097,this.romBaudrate=115200,this.debugLogging=!1,this.syncStubDetected=!1,this.flashSizeBytes=function(t){let e=-1;return -1!==t.indexOf("KB")?e=1024*parseInt(t.slice(0,t.indexOf("KB"))):-1!==t.indexOf("MB")&&(e=1048576*parseInt(t.slice(0,t.indexOf("MB")))),e},this.IS_STUB=!1,this.FLASH_WRITE_SIZE=16384,this.transport=t.transport,this.baudrate=t.baudrate,this.resetConstructors={classicReset:(t,e)=>new h(t,e),customReset:(t,e)=>new c(t,e),hardReset:(t,e)=>new l(t,e),usbJTAGSerialReset:t=>new o(t)},t.serialOptions&&(this.serialOptions=t.serialOptions),t.romBaudrate&&(this.romBaudrate=t.romBaudrate),t.terminal&&(this.terminal=t.terminal,this.terminal.clean()),void 0!==t.debugLogging&&(this.debugLogging=t.debugLogging),t.port&&(this.transport=new a(t.port)),void 0!==t.enableTracing&&(this.transport.tracing=t.enableTracing),(null===(e=t.resetConstructors)||void 0===e?void 0:e.classicReset)&&(this.resetConstructors.classicReset=null===(i=t.resetConstructors)||void 0===i?void 0:i.classicReset),(null===(r=t.resetConstructors)||void 0===r?void 0:r.customReset)&&(this.resetConstructors.customReset=null===(s=t.resetConstructors)||void 0===s?void 0:s.customReset),(null===(n=t.resetConstructors)||void 0===n?void 0:n.hardReset)&&(this.resetConstructors.hardReset=null===(d=t.resetConstructors)||void 0===d?void 0:d.hardReset),(null===(u=t.resetConstructors)||void 0===u?void 0:u.usbJTAGSerialReset)&&(this.resetConstructors.usbJTAGSerialReset=null===(_=t.resetConstructors)||void 0===_?void 0:_.usbJTAGSerialReset),this.info("esptool.js"),this.info("Serial port "+this.transport.getInfo())}_sleep(t){return new Promise(e=>setTimeout(e,t))}write(t,e=!0){this.terminal?e?this.terminal.writeLine(t):this.terminal.write(t):console.log(t)}error(t,e=!0){this.write(`Error: ${t}`,e)}info(t,e=!0){this.write(t,e)}debug(t,e=!0){this.debugLogging&&this.write(`Debug: ${t}`,e)}_shortToBytearray(t){return new Uint8Array([255&t,t>>8&255])}_intToByteArray(t){return new Uint8Array([255&t,t>>8&255,t>>16&255,t>>24&255])}_byteArrayToShort(t,e){return t|e>>8}_byteArrayToInt(t,e,i,r){return t|e<<8|i<<16|r<<24}_appendBuffer(t,e){let i=new Uint8Array(t.byteLength+e.byteLength);return i.set(new Uint8Array(t),0),i.set(new Uint8Array(e),t.byteLength),i.buffer}_appendArray(t,e){let i=new Uint8Array(t.length+e.length);return i.set(t,0),i.set(e,t.length),i}ui8ToBstr(t){let e="";for(let i=0;i<t.length;i++)e+=String.fromCharCode(t[i]);return e}bstrToUi8(t){let e=new Uint8Array(t.length);for(let i=0;i<t.length;i++)e[i]=t.charCodeAt(i);return e}async flushInput(){try{await this.transport.flushInput()}catch(t){this.error(t.message)}}async readPacket(t=null,e=this.DEFAULT_TIMEOUT){for(let i=0;i<100;i++){let{value:i}=await this.transport.read(e).next();if(!i||i.length<8)continue;let s=i[0];if(1!==s)continue;let a=i[1],n=this._byteArrayToInt(i[4],i[5],i[6],i[7]),h=i.slice(8);if(1==s){if(null==t||a==t)return[n,h];if(0!=h[0]&&h[1]==this.ROM_INVALID_RECV_MSG)throw await this.flushInput(),new r("unsupported command error")}}throw new r("invalid response")}async command(t=null,e=new Uint8Array(0),i=0,r=!0,s=this.DEFAULT_TIMEOUT){if(null!=t){let a;this.transport.tracing&&this.transport.trace(`command op:0x${t.toString(16).padStart(2,"0")} data len=${e.length} wait_response=${r?1:0} timeout=${(s/1e3).toFixed(3)} data=${this.transport.hexConvert(e)}`);let n=new Uint8Array(8+e.length);for(a=0,n[0]=0,n[1]=t,n[2]=this._shortToBytearray(e.length)[0],n[3]=this._shortToBytearray(e.length)[1],n[4]=this._intToByteArray(i)[0],n[5]=this._intToByteArray(i)[1],n[6]=this._intToByteArray(i)[2],n[7]=this._intToByteArray(i)[3];a<e.length;a++)n[8+a]=e[a];await this.transport.write(n)}return r?this.readPacket(t,s):[0,new Uint8Array(0)]}async readReg(t,e=this.DEFAULT_TIMEOUT){let i=this._intToByteArray(t);return(await this.command(this.ESP_READ_REG,i,void 0,void 0,e))[0]}async writeReg(t,e,i=4294967295,r=0,s=0){let a=this._appendArray(this._intToByteArray(t),this._intToByteArray(e));a=this._appendArray(a,this._intToByteArray(i)),a=this._appendArray(a,this._intToByteArray(r)),s>0&&(a=this._appendArray(a,this._intToByteArray(this.chip.UART_DATE_REG_ADDR)),a=this._appendArray(a,this._intToByteArray(0)),a=this._appendArray(a,this._intToByteArray(0)),a=this._appendArray(a,this._intToByteArray(s))),await this.checkCommand("write target memory",this.ESP_WRITE_REG,a)}async sync(){let t;this.debug("Sync");let e=new Uint8Array(36);for(t=0,e[0]=7,e[1]=7,e[2]=18,e[3]=32;t<32;t++)e[4+t]=85;try{let t=await this.command(8,e,void 0,void 0,100);this.syncStubDetected=0===t[0];for(let e=0;e<7;e++)t=await this.command(),this.syncStubDetected=this.syncStubDetected&&0===t[0];return t}catch(t){throw this.debug("Sync err "+t),t}}async _connectAttempt(t="default_reset",e){this.debug("_connect_attempt "+t),e&&await e.reset();let i=this.transport.inWaiting(),r=Array.from(await this.transport.newRead(i>0?i:1,this.DEFAULT_TIMEOUT),t=>String.fromCharCode(t)).join("").match(/boot:(0x[0-9a-fA-F]+)(.*waiting for download)?/),s=!1,a="",n=!1;r&&(s=!0,a=r[1],n=!!r[2]);let h="";for(let t=0;t<5;t++)try{this.debug(`Sync connect attempt ${t}`);let e=await this.sync();return this.debug(e[0].toString()),"success"}catch(t){this.debug(`Error at sync ${t}`),h=t instanceof Error?t.message:"string"==typeof t?t:JSON.stringify(t)}return s&&(h=`Wrong boot mode detected (${a}).
        This chip needs to be in download mode.`,n&&(h=`Download mode successfully detected, but getting no sync reply:
           The serial TX path seems to be down.`)),h}constructResetSequence(t){if("no_reset"!==t){if("usb_reset"===t||this.transport.getPid()===this.USB_JTAG_SERIAL_PID){if(this.resetConstructors.usbJTAGSerialReset)return this.debug("using USB JTAG Serial Reset"),[this.resetConstructors.usbJTAGSerialReset(this.transport)]}else if(this.resetConstructors.classicReset)return this.debug("using Classic Serial Reset"),[this.resetConstructors.classicReset(this.transport,50),this.resetConstructors.classicReset(this.transport,550)]}return[]}async connect(t="default_reset",e=7,i=!0){let s;this.info("Connecting...",!1),await this.transport.connect(this.romBaudrate,this.serialOptions);let a=this.constructResetSequence(t);for(let i=0;i<e;i++){let e=a.length>0?a[i%a.length]:null;if("success"===(s=await this._connectAttempt(t,e)))break}if("success"!==s)throw new r("Failed to connect with the device");if(this.debug("Connect attempt successful."),this.info("\n\r",!1),i){let t=await this.readReg(this.CHIP_DETECT_MAGIC_REG_ADDR)>>>0;this.debug("Chip Magic "+t.toString(16));let e=await p(t);if(null===this.chip)throw new r(`Unexpected CHIP magic value ${t}. Failed to autodetect chip type.`);this.chip=e}}async detectChip(t="default_reset"){await this.connect(t),this.info("Detecting chip type... ",!1),null!=this.chip?this.info(this.chip.CHIP_NAME):this.info("unknown!")}async checkCommand(t="",e=null,i=new Uint8Array(0),r=0,s=this.DEFAULT_TIMEOUT){this.debug("check_command "+t);let a=await this.command(e,i,r,void 0,s);return a[1].length>4?a[1]:a[0]}async memBegin(t,e,i,s){if(this.IS_STUB){let e=s+t,i=await _(this.chip.CHIP_NAME);if(i){for(let[t,a]of[[i.bss_start||i.data_start,i.data_start+i.decodedData.length],[i.text_start,i.text_start+i.decodedText.length]])if(s<a&&e>t)throw new r(`Software loader is resident at 0x${t.toString(16).padStart(8,"0")}-0x${a.toString(16).padStart(8,"0")}.
            Can't load binary at overlapping address range 0x${s.toString(16).padStart(8,"0")}-0x${e.toString(16).padStart(8,"0")}.
            Either change binary loading address, or use the no-stub option to disable the software loader.`)}}this.debug("mem_begin "+t+" "+e+" "+i+" "+s.toString(16));let a=this._appendArray(this._intToByteArray(t),this._intToByteArray(e));a=this._appendArray(a,this._intToByteArray(i)),a=this._appendArray(a,this._intToByteArray(s)),await this.checkCommand("enter RAM download mode",this.ESP_MEM_BEGIN,a)}checksum(t,e=this.ESP_CHECKSUM_MAGIC){for(let i=0;i<t.length;i++)e^=t[i];return e}async memBlock(t,e){let i=this._appendArray(this._intToByteArray(t.length),this._intToByteArray(e));i=this._appendArray(i,this._intToByteArray(0)),i=this._appendArray(i,this._intToByteArray(0)),i=this._appendArray(i,t);let r=this.checksum(t);await this.checkCommand("write to target RAM",this.ESP_MEM_DATA,i,r)}async memFinish(t){let e=this._appendArray(this._intToByteArray(0===t?1:0),this._intToByteArray(t));await this.checkCommand("leave RAM download mode",this.ESP_MEM_END,e,void 0,200)}async flashSpiAttach(t){let e=this._intToByteArray(t);await this.checkCommand("configure SPI flash pins",this.ESP_SPI_ATTACH,e)}timeoutPerMb(t,e){let i=e/1e6*t;return i<3e3?3e3:i}async flashBegin(t,e){let i=Math.floor((t+this.FLASH_WRITE_SIZE-1)/this.FLASH_WRITE_SIZE),r=this.chip.getEraseSize(e,t),s=new Date,a=s.getTime(),n=3e3;!1==this.IS_STUB&&(n=this.timeoutPerMb(this.ERASE_REGION_TIMEOUT_PER_MB,t)),this.debug("flash begin "+r+" "+i+" "+this.FLASH_WRITE_SIZE+" "+e+" "+t);let h=this._appendArray(this._intToByteArray(r),this._intToByteArray(i));h=this._appendArray(h,this._intToByteArray(this.FLASH_WRITE_SIZE)),h=this._appendArray(h,this._intToByteArray(e)),!1==this.IS_STUB&&(h=this._appendArray(h,this._intToByteArray(0))),await this.checkCommand("enter Flash download mode",this.ESP_FLASH_BEGIN,h,void 0,n);let o=s.getTime();return 0!=t&&!1==this.IS_STUB&&this.info("Took "+(o-a)/1e3+"."+(o-a)%1e3+"s to erase flash block"),i}async flashDeflBegin(t,e,i){let r,s;let a=Math.floor((e+this.FLASH_WRITE_SIZE-1)/this.FLASH_WRITE_SIZE),n=Math.floor((t+this.FLASH_WRITE_SIZE-1)/this.FLASH_WRITE_SIZE),h=new Date,o=h.getTime();this.IS_STUB?(r=t,s=this.DEFAULT_TIMEOUT):(r=n*this.FLASH_WRITE_SIZE,s=this.timeoutPerMb(this.ERASE_REGION_TIMEOUT_PER_MB,r)),this.info("Compressed "+t+" bytes to "+e+"...");let l=this._appendArray(this._intToByteArray(r),this._intToByteArray(a));l=this._appendArray(l,this._intToByteArray(this.FLASH_WRITE_SIZE)),l=this._appendArray(l,this._intToByteArray(i)),("ESP32-S2"===this.chip.CHIP_NAME||"ESP32-S3"===this.chip.CHIP_NAME||"ESP32-C3"===this.chip.CHIP_NAME||"ESP32-C2"===this.chip.CHIP_NAME)&&!1===this.IS_STUB&&(l=this._appendArray(l,this._intToByteArray(0))),await this.checkCommand("enter compressed flash mode",this.ESP_FLASH_DEFL_BEGIN,l,void 0,s);let c=h.getTime();return 0!=t&&!1===this.IS_STUB&&this.info("Took "+(c-o)/1e3+"."+(c-o)%1e3+"s to erase flash block"),a}async flashBlock(t,e,i){let r=this._appendArray(this._intToByteArray(t.length),this._intToByteArray(e));r=this._appendArray(r,this._intToByteArray(0)),r=this._appendArray(r,this._intToByteArray(0)),r=this._appendArray(r,t);let s=this.checksum(t);await this.checkCommand("write to target Flash after seq "+e,this.ESP_FLASH_DATA,r,s,i)}async flashDeflBlock(t,e,i){let r=this._appendArray(this._intToByteArray(t.length),this._intToByteArray(e));r=this._appendArray(r,this._intToByteArray(0)),r=this._appendArray(r,this._intToByteArray(0)),r=this._appendArray(r,t);let s=this.checksum(t);this.debug("flash_defl_block "+t[0].toString(16)+" "+t[1].toString(16)),await this.checkCommand("write compressed data to flash after seq "+e,this.ESP_FLASH_DEFL_DATA,r,s,i)}async flashFinish(t=!1){let e=this._intToByteArray(t?0:1);await this.checkCommand("leave Flash mode",this.ESP_FLASH_END,e)}async flashDeflFinish(t=!1){let e=this._intToByteArray(t?0:1);await this.checkCommand("leave compressed flash mode",this.ESP_FLASH_DEFL_END,e)}async runSpiflashCommand(t,e,i){let s,a;let n=this.chip.SPI_REG_BASE,h=n+0,o=n+this.chip.SPI_USR_OFFS,l=n+this.chip.SPI_USR1_OFFS,c=n+this.chip.SPI_USR2_OFFS,d=n+this.chip.SPI_W0_OFFS;if(s=null!=this.chip.SPI_MOSI_DLEN_OFFS?async(t,e)=>{let i=n+this.chip.SPI_MOSI_DLEN_OFFS,r=n+this.chip.SPI_MISO_DLEN_OFFS;t>0&&await this.writeReg(i,t-1),e>0&&await this.writeReg(r,e-1)}:async(t,e)=>{await this.writeReg(l,(0===e?0:e-1)<<8|(0===t?0:t-1)<<17)},i>32)throw new r("Reading more than 32 bits back from a SPI flash operation is unsupported");if(e.length>64)throw new r("Writing more than 64 bytes of data with one SPI command is unsupported");let u=8*e.length,_=await this.readReg(o),f=await this.readReg(c),p=-2147483648;i>0&&(p|=268435456),u>0&&(p|=134217728),await s(u,i),await this.writeReg(o,p);let y=1879048192|t;if(await this.writeReg(c,y),0==u)await this.writeReg(d,0);else{if(e.length%4!=0){let t=new Uint8Array(e.length%4);e=this._appendArray(e,t)}let t=d;for(a=0;a<e.length-4;a+=4)y=this._byteArrayToInt(e[a],e[a+1],e[a+2],e[a+3]),await this.writeReg(t,y),t+=4}for(await this.writeReg(h,262144),a=0;a<10&&0!=(y=await this.readReg(h)&262144);a++);if(10===a)throw new r("SPI command did not complete in time");let w=await this.readReg(d);return await this.writeReg(o,_),await this.writeReg(c,f),w}async readFlashId(){let t=new Uint8Array(0);return await this.runSpiflashCommand(159,t,24)}async eraseFlash(){this.info("Erasing flash (this may take a while)...");let t=new Date,e=t.getTime(),i=await this.checkCommand("erase flash",this.ESP_ERASE_FLASH,void 0,void 0,this.CHIP_ERASE_TIMEOUT),r=(t=new Date).getTime();return this.info("Chip erase completed successfully in "+(r-e)/1e3+"s"),i}toHex(t){return Array.prototype.map.call(t,t=>("00"+t.toString(16)).slice(-2)).join("")}async flashMd5sum(t,e){let i=this.timeoutPerMb(this.MD5_TIMEOUT_PER_MB,e),r=this._appendArray(this._intToByteArray(t),this._intToByteArray(e));r=this._appendArray(r,this._intToByteArray(0)),r=this._appendArray(r,this._intToByteArray(0));let s=await this.checkCommand("calculate md5sum",this.ESP_SPI_FLASH_MD5,r,void 0,i);return s instanceof Uint8Array&&s.length>16&&(s=s.slice(0,16)),this.toHex(s)}async readFlash(t,e,i=null){let s=this._appendArray(this._intToByteArray(t),this._intToByteArray(e));s=this._appendArray(s,this._intToByteArray(4096)),s=this._appendArray(s,this._intToByteArray(1024));let a=await this.checkCommand("read flash",this.ESP_READ_FLASH,s);if(0!=a)throw new r("Failed to read memory: "+a);let n=new Uint8Array(0);for(;n.length<e;){let{value:t}=await this.transport.read(this.FLASH_READ_TIMEOUT).next();if(t instanceof Uint8Array)t.length>0&&(n=this._appendArray(n,t),await this.transport.write(this._intToByteArray(n.length)),i&&i(t,n.length,e));else throw new r("Failed to read memory: "+t)}return n}async runStub(){if(this.syncStubDetected)return this.info("Stub is already running. No upload is necessary."),this.chip;this.info("Uploading stub...");let t=await _(this.chip.CHIP_NAME);if(void 0===t)throw this.debug("Error loading Stub json"),Error("Error loading Stub json");let e=[t.decodedText,t.decodedData];for(let i=0;i<e.length;i++)if(e[i]){let r=0===i?t.text_start:t.data_start,s=e[i].length,a=Math.floor((s+this.ESP_RAM_BLOCK-1)/this.ESP_RAM_BLOCK);await this.memBegin(s,a,this.ESP_RAM_BLOCK,r);for(let t=0;t<a;t++){let r=t*this.ESP_RAM_BLOCK,s=r+this.ESP_RAM_BLOCK;await this.memBlock(e[i].slice(r,s),t)}}this.info("Running stub..."),await this.memFinish(t.entry);let{value:i}=await this.transport.read(this.DEFAULT_TIMEOUT).next(),s=String.fromCharCode(...i);if("OHAI"!==s)throw new r(`Failed to start stub. Unexpected response ${s}`);return this.info("Stub running..."),this.IS_STUB=!0,this.chip}async changeBaud(){this.info("Changing baudrate to "+this.baudrate);let t=this.IS_STUB?this.romBaudrate:0,e=this._appendArray(this._intToByteArray(this.baudrate),this._intToByteArray(t));await this.command(this.ESP_CHANGE_BAUDRATE,e),this.info("Changed"),await this.transport.disconnect(),await this._sleep(50),await this.transport.connect(this.baudrate,this.serialOptions)}async main(t="default_reset"){await this.detectChip(t);let e=await this.chip.getChipDescription(this);return this.info("Chip is "+e),this.info("Features: "+await this.chip.getChipFeatures(this)),this.info("Crystal is "+await this.chip.getCrystalFreq(this)+"MHz"),this.info("MAC: "+await this.chip.readMac(this)),await this.chip.readMac(this),void 0!==this.chip.postConnect&&await this.chip.postConnect(this),await this.runStub(),this.romBaudrate!==this.baudrate&&await this.changeBaud(),e}parseFlashSizeArg(t){if(void 0===this.chip.FLASH_SIZES[t])throw new r("Flash size "+t+" is not supported by this chip type. Supported sizes: "+this.chip.FLASH_SIZES);return this.chip.FLASH_SIZES[t]}_updateImageFlashParams(t,e,i,r,s){if(this.debug("_update_image_flash_params "+i+" "+r+" "+s),t.length<8||e!=this.chip.BOOTLOADER_FLASH_OFFSET)return t;if("keep"===i&&"keep"===r&&"keep"===s)return this.info("Not changing the image"),t;let a=parseInt(t[0]),n=parseInt(t[2]),h=parseInt(t[3]);if(a!==this.ESP_IMAGE_MAGIC)return this.info("Warning: Image file at 0x"+e.toString(16)+" doesn't look like an image file, so not changing any flash settings."),t;"keep"!==r&&(n=({qio:0,qout:1,dio:2,dout:3})[r]);let o=15&h;"keep"!==s&&(o=({"40m":0,"26m":1,"20m":2,"80m":15})[s]);let l=240&h;"keep"!==i&&(l=this.parseFlashSizeArg(i));let c=n<<8|o+l;return this.info("Flash params set to "+c.toString(16)),parseInt(t[2])!==n<<8&&(t=t.substring(0,2)+(n<<8).toString()+t.substring(3)),parseInt(t[3])!==o+l&&(t=t.substring(0,3)+(o+l).toString()+t.substring(4)),t}async writeFlash(t){let e,i;if(this.debug("EspLoader program"),"keep"!==t.flashSize){let e=this.flashSizeBytes(t.flashSize);for(let i=0;i<t.fileArray.length;i++)if(t.fileArray[i].data.length+t.fileArray[i].address>e)throw new r(`File ${i+1} doesn't fit in the available flash`)}!0===this.IS_STUB&&!0===t.eraseAll&&await this.eraseFlash();for(let a=0;a<t.fileArray.length;a++){let n;if(this.debug("Data Length "+t.fileArray[a].data.length),e=t.fileArray[a].data,this.debug("Image Length "+e.length),0===e.length){this.debug("Warning: File is empty");continue}e=this.ui8ToBstr(function(t,e,i=255){let r=t.length%4;if(0!==r){let e=new Uint8Array(4-r).fill(i),s=new Uint8Array(t.length+e.length);return s.set(t),s.set(e,t.length),s}return t}(this.bstrToUi8(e),0)),i=t.fileArray[a].address,e=this._updateImageFlashParams(e,i,t.flashSize,t.flashMode,t.flashFreq);let h=null;t.calculateMD5Hash&&(h=t.calculateMD5Hash(e),this.debug("Image MD5 "+h));let o=e.length;if(t.compress){let t=this.bstrToUi8(e);e=this.ui8ToBstr((0,s.Wt)(t,{level:9})),n=await this.flashDeflBegin(o,e.length,i)}else n=await this.flashBegin(o,i);let l=0,c=0,d=e.length;t.reportProgress&&t.reportProgress(a,0,d);let u=new Date,_=u.getTime(),f=5e3,p=new s.T_({chunkSize:1}),y=0;for(p.onData=function(t){y+=t.byteLength};e.length>0;){this.debug("Write loop "+i+" "+l+" "+n),this.info("Writing at 0x"+(i+y).toString(16)+"... ("+Math.floor(100*(l+1)/n)+"%)");let s=this.bstrToUi8(e.slice(0,this.FLASH_WRITE_SIZE));if(t.compress){let t=y;p.push(s,!1);let e=y-t,i=3e3;this.timeoutPerMb(this.ERASE_WRITE_TIMEOUT_PER_MB,e)>3e3&&(i=this.timeoutPerMb(this.ERASE_WRITE_TIMEOUT_PER_MB,e)),!1===this.IS_STUB&&(f=i),await this.flashDeflBlock(s,l,f),this.IS_STUB&&(f=i)}else throw new r("Yet to handle Non Compressed writes");c+=s.length,e=e.slice(this.FLASH_WRITE_SIZE,e.length),l++,t.reportProgress&&t.reportProgress(a,c,d)}this.IS_STUB&&await this.readReg(this.CHIP_DETECT_MAGIC_REG_ADDR,f);let w=(u=new Date).getTime()-_;if(t.compress&&this.info("Wrote "+o+" bytes ("+c+" compressed) at 0x"+i.toString(16)+" in "+w/1e3+" seconds."),h){let t=await this.flashMd5sum(i,o);if(new String(t).valueOf()!=new String(h).valueOf())throw this.info("File  md5: "+h),this.info("Flash md5: "+t),new r("MD5 of file does not match data in flash!");this.info("Hash of data verified.")}}this.info("Leaving..."),this.IS_STUB&&(await this.flashBegin(0,0),t.compress?await this.flashDeflFinish():await this.flashFinish())}async flashId(){this.debug("flash_id");let t=await this.readFlashId();this.info("Manufacturer: "+(255&t).toString(16));let e=t>>16&255;this.info("Device: "+(t>>8&255).toString(16)+e.toString(16)),this.info("Detected flash size: "+this.DETECTED_FLASH_SIZES[e])}async getFlashSize(){this.debug("flash_id");let t=await this.readFlashId();return this.DETECTED_FLASH_SIZES_NUM[t>>16&255]}async softReset(t){if(this.IS_STUB){if("ESP8266"!=this.chip.CHIP_NAME)throw new r("Soft resetting is currently only supported on ESP8266");t?(await this.flashBegin(0,0),await this.flashFinish(!0)):await this.command(this.ESP_RUN_USER_CODE,void 0,void 0,!1)}else{if(t)return;await this.flashBegin(0,0),await this.flashFinish(!1)}}async after(t="hard_reset",e){switch(t){case"hard_reset":if(this.resetConstructors.hardReset){this.info("Hard resetting via RTS pin...");let t=this.resetConstructors.hardReset(this.transport,e);await t.reset()}break;case"soft_reset":this.info("Soft resetting..."),await this.softReset(!1);break;case"no_reset_stub":this.info("Staying in flasher stub.");break;default:this.info("Staying in bootloader."),this.IS_STUB&&this.softReset(!0)}}}},8755:function(t,e,i){"use strict";i.d(e,{Z:function(){return d}});var r=i(2265);let s=function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];return e.filter((t,e,i)=>!!t&&""!==t.trim()&&i.indexOf(t)===e).join(" ").trim()},a=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),n=t=>t.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,e,i)=>i?i.toUpperCase():e.toLowerCase()),h=t=>{let e=n(t);return e.charAt(0).toUpperCase()+e.slice(1)};var o={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let l=t=>{for(let e in t)if(e.startsWith("aria-")||"role"===e||"title"===e)return!0;return!1},c=(0,r.forwardRef)((t,e)=>{let{color:i="currentColor",size:a=24,strokeWidth:n=2,absoluteStrokeWidth:h,className:c="",children:d,iconNode:u,..._}=t;return(0,r.createElement)("svg",{ref:e,...o,width:a,height:a,stroke:i,strokeWidth:h?24*Number(n)/Number(a):n,className:s("lucide",c),...!d&&!l(_)&&{"aria-hidden":"true"},..._},[...u.map(t=>{let[e,i]=t;return(0,r.createElement)(e,i)}),...Array.isArray(d)?d:[d]])}),d=(t,e)=>{let i=(0,r.forwardRef)((i,n)=>{let{className:o,...l}=i;return(0,r.createElement)(c,{ref:n,iconNode:e,className:s("lucide-".concat(a(h(t))),"lucide-".concat(t),o),...l})});return i.displayName=h(t),i}},4622:function(t,e,i){"use strict";i.d(e,{Z:function(){return r}});let r=(0,i(8755).Z)("bitcoin",[["path",{d:"M11.767 19.089c4.924.868 6.14-6.025 1.216-6.894m-1.216 6.894L5.86 18.047m5.908 1.042-.347 1.97m1.563-8.864c4.924.869 6.14-6.025 1.215-6.893m-1.215 6.893-3.94-.694m5.155-6.2L8.29 4.26m5.908 1.042.348-1.97M7.48 20.364l3.126-17.727",key:"yr8idg"}]])},875:function(t,e,i){"use strict";i.d(e,{Z:function(){return r}});let r=(0,i(8755).Z)("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]])},2135:function(t,e,i){"use strict";i.d(e,{Z:function(){return r}});let r=(0,i(8755).Z)("chevron-up",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]])},1723:function(t,e,i){"use strict";i.d(e,{Z:function(){return r}});let r=(0,i(8755).Z)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]])},2735:function(t,e,i){"use strict";i.d(e,{Z:function(){return r}});let r=(0,i(8755).Z)("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]])},9202:function(t,e,i){"use strict";i.d(e,{Z:function(){return r}});let r=(0,i(8755).Z)("globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]])},7226:function(t,e,i){"use strict";i.d(e,{Z:function(){return r}});let r=(0,i(8755).Z)("moon",[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401",key:"kfwtm"}]])},3388:function(t,e,i){"use strict";i.d(e,{Z:function(){return r}});let r=(0,i(8755).Z)("smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]])},4908:function(t,e,i){"use strict";i.d(e,{Z:function(){return r}});let r=(0,i(8755).Z)("tram-front",[["rect",{width:"16",height:"16",x:"4",y:"3",rx:"2",key:"1wxw4b"}],["path",{d:"M4 11h16",key:"mpoxn0"}],["path",{d:"M12 3v8",key:"1h2ygw"}],["path",{d:"m8 19-2 3",key:"13i0xs"}],["path",{d:"m18 22-2-3",key:"1p0ohu"}],["path",{d:"M8 15h.01",key:"a7atzg"}],["path",{d:"M16 15h.01",key:"rnfrdf"}]])},2926:function(t,e,i){"use strict";i.d(e,{Z:function(){return r}});let r=(0,i(8755).Z)("wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]])},1239:function(t,e,i){"use strict";i.d(e,{Z:function(){return r}});let r=(0,i(8755).Z)("zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]])},257:function(t,e,i){"use strict";var r,s;t.exports=(null==(r=i.g.process)?void 0:r.env)&&"object"==typeof(null==(s=i.g.process)?void 0:s.env)?i.g.process:i(4227)},4227:function(t){!function(){var e={229:function(t){var e,i,r,s=t.exports={};function a(){throw Error("setTimeout has not been defined")}function n(){throw Error("clearTimeout has not been defined")}function h(t){if(e===setTimeout)return setTimeout(t,0);if((e===a||!e)&&setTimeout)return e=setTimeout,setTimeout(t,0);try{return e(t,0)}catch(i){try{return e.call(null,t,0)}catch(i){return e.call(this,t,0)}}}!function(){try{e="function"==typeof setTimeout?setTimeout:a}catch(t){e=a}try{i="function"==typeof clearTimeout?clearTimeout:n}catch(t){i=n}}();var o=[],l=!1,c=-1;function d(){l&&r&&(l=!1,r.length?o=r.concat(o):c=-1,o.length&&u())}function u(){if(!l){var t=h(d);l=!0;for(var e=o.length;e;){for(r=o,o=[];++c<e;)r&&r[c].run();c=-1,e=o.length}r=null,l=!1,function(t){if(i===clearTimeout)return clearTimeout(t);if((i===n||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(t);try{i(t)}catch(e){try{return i.call(null,t)}catch(e){return i.call(this,t)}}}(t)}}function _(t,e){this.fun=t,this.array=e}function f(){}s.nextTick=function(t){var e=Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];o.push(new _(t,e)),1!==o.length||l||h(u)},_.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=f,s.addListener=f,s.once=f,s.off=f,s.removeListener=f,s.removeAllListeners=f,s.emit=f,s.prependListener=f,s.prependOnceListener=f,s.listeners=function(t){return[]},s.binding=function(t){throw Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(t){throw Error("process.chdir is not supported")},s.umask=function(){return 0}}},i={};function r(t){var s=i[t];if(void 0!==s)return s.exports;var a=i[t]={exports:{}},n=!0;try{e[t](a,a.exports,r),n=!1}finally{n&&delete i[t]}return a.exports}r.ab="//";var s=r(229);t.exports=s}()}}]);